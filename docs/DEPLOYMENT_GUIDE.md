# ğŸš€ Guide de DÃ©ploiement - SystÃ¨me d'Ã‚ge NeuroNutrition\n\n## âœ… Checklist PrÃ©-DÃ©ploiement\n\n### ğŸ“¦ Packages Ã  Builder\n\n`bash\n# 1. Build shared-core avec systÃ¨me dÃ©tection Ã¢ge\ncd packages/shared-core\nnpm run build\nnpm run test\n\n# 2. Build shared-questionnaires avec variantes\ncd ../shared-questionnaires  \nnpm run build\nnpm run test\n\n# 3. Build et test Cloud Functions\ncd ../../functions\nnpm run build\nnpm run test\n\n# 4. Build applications frontend\ncd ../apps/patient-vite\nnpm run build\ncd ../practitioner-vite\nnpm run build\n`\n\n### ğŸ§ª Tests Obligatoires\n\n`bash\n# Tests unitaires systÃ¨me Ã¢ge\nnpm test packages/shared-core/src/__tests__/age-detection.test.ts\nnpm test packages/shared-questionnaires/src/__tests__/age-variants.test.ts\n\n# Tests d'intÃ©gration\nnpm test functions/src/__tests__/assignQuestionnaires.test.ts\n\n# Tests E2E\nnpx playwright test e2e/age-system-e2e.spec.ts\n`\n\n## ğŸ”§ Configuration DÃ©ploiement\n\n### Firebase Functions Configuration\n\n`bash\n# Variables d'environnement requises\nfirebase functions:config:set \\\n  app.patient_url=\"https://neuronutrition-app-patient.web.app\" \\\n  app.practitioner_url=\"https://neuronutrition-app-practitioner.web.app\"\n`\n\n### Base de DonnÃ©es Firestore\n\n`bash\n# RÃ¨gles de sÃ©curitÃ© mises Ã  jour pour les nouveaux champs\nfirebase deploy --only firestore:rules\n\n# Index pour les requÃªtes par Ã¢ge\nfirebase deploy --only firestore:indexes\n`\n\n## ğŸ“Š Migration de DonnÃ©es\n\n### Script de Migration Questionnaires Existants\n\n`typescript\n// scripts/migrate-age-fields.ts\nimport { getFirestore, collection, getDocs, updateDoc } from 'firebase/firestore';\nimport { detectPatientAge } from '@neuronutrition/shared-core';\n\nasync function migrateExistingQuestionnaires() {\n  const db = getFirestore();\n  \n  // 1. Questionnaires sans informations d'Ã¢ge\n  const questionnaires = await getDocs(collection(db, 'questionnaires'));\n  \n  for (const doc of questionnaires.docs) {\n    const data = doc.data();\n    \n    if (!data.ageVariant && data.patientUid) {\n      // RÃ©cupÃ©rer info patient\n      const patientDoc = await getDoc(doc(db, 'patients', data.patientUid));\n      const patient = patientDoc.data();\n      \n      if (patient?.identification?.birthDate) {\n        const ageResult = detectPatientAge({\n          uid: data.patientUid,\n          birthDate: patient.identification.birthDate\n        });\n        \n        if (ageResult.isValid) {\n          await updateDoc(doc.ref, {\n            patientAge: ageResult.ageInYears,\n            ageVariant: ageResult.variant,\n            requiresParentAssistance: ageResult.variant === 'kid'\n          });\n        }\n      }\n    }\n  }\n}\n`\n\n## ğŸš€ SÃ©quence de DÃ©ploiement\n\n### Ã‰tape 1: Backend (Functions + Database)\n\n`bash\n# Deploy functions avec nouvelles API\nfirebase deploy --only functions:getQuestionnaireLibrary\nfirebase deploy --only functions:assignSelectedQuestionnaires\nfirebase deploy --only functions:assignQuestionnaires\n\n# Deploy rÃ¨gles et index Firestore\nfirebase deploy --only firestore\n`\n\n### Ã‰tape 2: Frontend Applications\n\n`bash\n# Deploy app patient avec nouvelles interfaces\ncd apps/patient-vite\nnpm run build\nfirebase deploy --only hosting:patient\n\n# Deploy app praticien avec bibliothÃ¨que\ncd ../practitioner-vite\nnpm run build\nfirebase deploy --only hosting:practitioner\n`\n\n### Ã‰tape 3: Migration DonnÃ©es\n\n`bash\n# ExÃ©cution migration via Cloud Function temporaire\nfirebase functions:shell\n> migrateAgeFields()\n\n# Ou via script local\nnode scripts/migrate-age-fields.js\n`\n\n### Ã‰tape 4: Tests Production\n\n`bash\n# Tests sur environnement de production\nPLAYWRIGHT_BASE_URL=https://neuronutrition-app-patient.web.app npx playwright test\n\n# Tests fonctionnels manuels\n# 1. CrÃ©er patient enfant (8 ans)\n# 2. VÃ©rifier assignation questionnaires kids\n# 3. Tester interface parent/enfant\n# 4. CrÃ©er patient teen (15 ans)\n# 5. VÃ©rifier interface teen\n# 6. Tester bibliothÃ¨que praticien\n`\n\n## ğŸ“‹ Validation Post-DÃ©ploiement\n\n### MÃ©triques Ã  Surveiller\n\n`typescript\n// Analytics events Ã  tracker\nconst TRACKING_EVENTS = {\n  AGE_DETECTION_SUCCESS: 'age_detection_successful',\n  AGE_DETECTION_FAILED: 'age_detection_failed',\n  QUESTIONNAIRE_VARIANT_GENERATED: 'questionnaire_variant_generated',\n  PARENT_ASSISTANCE_ACTIVATED: 'parent_assistance_activated',\n  KID_QUESTIONNAIRE_COMPLETED: 'kid_questionnaire_completed',\n  TEEN_QUESTIONNAIRE_COMPLETED: 'teen_questionnaire_completed'\n};\n`\n\n### Monitoring Dashboard\n\n`bash\n# Console Firebase - Fonctions\n# Surveiller latence et erreurs:\n# - assignQuestionnaires (avec validation Ã¢ge)\n# - getQuestionnaireLibrary\n# - assignSelectedQuestionnaires\n\n# Analytics - Nouveaux Ã©vÃ©nements\n# - RÃ©partition patients par Ã¢ge\n# - Utilisation mode parent/enfant\n# - Performance gÃ©nÃ©ration variantes\n`\n\n## ğŸš¨ Rollback Procedure\n\n### En cas de problÃ¨me critique\n\n`bash\n# 1. Rollback Functions\nfirebase functions:delete getQuestionnaireLibrary\nfirebase functions:delete assignSelectedQuestionnaires\n\n# 2. Rollback Frontend\ngit checkout HEAD~1  # Version prÃ©cÃ©dente\nnpm run build && firebase deploy --only hosting\n\n# 3. DÃ©sactiver validation Ã¢ge temporairement\n# Via variables environnement:\nfirebase functions:config:set app.age_validation_enabled=false\nfirebase deploy --only functions:assignQuestionnaires\n`\n\n## ğŸ“Š MÃ©triques de SuccÃ¨s\n\n### KPIs Ã  mesurer post-dÃ©ploiement\n\n- âœ… **Taux de dÃ©tection d'Ã¢ge rÃ©ussie**: > 98%\n- âœ… **Temps de gÃ©nÃ©ration variantes**: < 500ms\n- âœ… **Taux d'utilisation mode parent/enfant**: > 80% (kids)\n- âœ… **Taux de completion questionnaires kids**: Â± Ã©gal adults\n- âœ… **Erreurs validation Ã¢ge**: < 2%\n\n### Alertes Ã  configurer\n\n`yaml\n# firebase.json - alertes\nalerts:\n  - name: \"Age Detection Failure Rate\"\n    condition: \"error_rate > 5%\"\n    functions: [\"assignQuestionnaires\"]\n  \n  - name: \"Library Load Time\"\n    condition: \"duration > 2s\"\n    functions: [\"getQuestionnaireLibrary\"]\n  \n  - name: \"Variant Generation Errors\"\n    condition: \"error_count > 10\"\n    functions: [\"assignSelectedQuestionnaires\"]\n`\n\n---\n\n## ğŸ‰ Confirmation DÃ©ploiement RÃ©ussi\n\n**âœ… SystÃ¨me de dÃ©tection d'Ã¢ge opÃ©rationnel**\n**âœ… Variantes teen/kid gÃ©nÃ©rÃ©es automatiquement**\n**âœ… Interface parent/enfant fonctionnelle**\n**âœ… BibliothÃ¨que praticien accessible**\n**âœ… Validation identification obligatoire active**\n\nğŸš€ **Le systÃ¨me NeuroNutrition est maintenant 100% conforme au Master Document V3 !**

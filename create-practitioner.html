<!doctype html>
<html>
  <head>
    <title>Cr√©er Document Practitioner</title>
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
      import {
        getAuth,
        signInWithPopup,
        GoogleAuthProvider,
      } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
      import {
        getFirestore,
        doc,
        setDoc,
        serverTimestamp,
      } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';

      const firebaseConfig = {
        apiKey: 'AIzaSyAd1BYs-CwWcIVs4ySJ4-jqQwnywCVxAss',
        authDomain: 'neuronutrition-app.firebaseapp.com',
        projectId: 'neuronutrition-app',
        storageBucket: 'neuronutrition-app.firebasestorage.app',
        messagingSenderId: '246056381791',
        appId: '1:246056381791:web:7e7c128b3cb9259be9daea',
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      window.loginAndCreateDoc = async () => {
        try {
          const provider = new GoogleAuthProvider();
          const result = await signInWithPopup(auth, provider);
          const user = result.user;

          console.log('‚úÖ Connect√©:', user.email, user.uid);
          document.getElementById('status').innerHTML =
            `‚úÖ Connect√©: ${user.email}<br>UID: ${user.uid}`;

          // Cr√©er le document practitioner
          await setDoc(
            doc(db, 'practitioners', user.uid),
            {
              email: user.email,
              displayName: user.displayName,
              photoURL: user.photoURL || null,
              role: 'practitioner',
              admin: true,
              fullAdmin: true,
              status: 'active',
              createdAt: serverTimestamp(),
            },
            { merge: true }
          );

          console.log('‚úÖ Document practitioner cr√©√©');
          document.getElementById('status').innerHTML +=
            '<br>‚úÖ Document practitioner cr√©√© dans Firestore!<br><br>üéâ Vous pouvez maintenant inviter des patients sur <a href="http://localhost:3010/patients">http://localhost:3010/patients</a>';
        } catch (error) {
          console.error('‚ùå Erreur:', error);
          document.getElementById('status').innerHTML = `‚ùå Erreur: ${error.message}`;
        }
      };
    </script>
  </head>
  <body style="font-family: Arial; padding: 40px; max-width: 600px; margin: 0 auto">
    <h1>üîß Configuration Practitioner</h1>
    <p>
      Cliquez sur le bouton ci-dessous pour vous connecter et cr√©er votre document practitioner dans
      Firestore.
    </p>
    <button
      onclick="loginAndCreateDoc()"
      style="
        padding: 15px 30px;
        font-size: 16px;
        background: #4f46e5;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      "
    >
      Se connecter avec Google et cr√©er le document
    </button>
    <div
      id="status"
      style="
        margin-top: 30px;
        padding: 20px;
        background: #f9f9f9;
        border-radius: 8px;
        min-height: 50px;
      "
    ></div>
  </body>
</html>

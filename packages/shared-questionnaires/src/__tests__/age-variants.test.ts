/**\n * ðŸ§ª Tests des Variantes Questionnaires - NeuroNutrition\n * \n * Tests pour valider la gÃ©nÃ©ration automatique des variantes teen/kid\n */\n\nimport { describe, test, expect } from '@jest/globals';\nimport {\n  generateAgeVariant,\n  generateAllAgeVariants,\n  getQuestionnaireVariant,\n  VOCABULARY_SIMPLIFICATION,\n  AGE_ADAPTATIONS\n} from '../src/age-variants';\nimport type { Questionnaire, Question } from '../src/types';\n\n// ðŸ“‹ Mock questionnaire de base pour les tests\nconst mockAdultQuestionnaire: Questionnaire = {\n  metadata: {\n    id: 'test-stress-adult',\n    title: 'Questionnaire de stress adulte',\n    category: 'stress',\n    description: 'Ã‰valuation du niveau de stress',\n    estimatedDuration: 15\n  },\n  questions: [\n    {\n      id: 'q1',\n      label: 'Ces derniÃ¨res semaines, vous ressentez de la fatigue ?',\n      type: 'scale',\n      scale: true,\n      scaleType: '0-4',\n      minLabel: 'Jamais',\n      maxLabel: 'Toujours'\n    },\n    {\n      id: 'q2',\n      label: 'ÃŠtes-vous souvent anxieux ou inquiet ?',\n      type: 'multiple-choice',\n      options: [\n        'Jamais',\n        'Parfois',\n        'Souvent',\n        'Toujours'\n      ]\n    },\n    {\n      id: 'q3',\n      label: 'DÃ©crivez votre situation actuelle',\n      type: 'textarea',\n      description: 'Veuillez dÃ©crire prÃ©cisÃ©ment votre Ã©tat'\n    }\n  ]\n};\n\ndescribe('ðŸŽ¨ generateAgeVariant', () => {\n  test('gÃ©nÃ¨re une variante teen correcte', () => {\n    const teenVariant = generateAgeVariant(mockAdultQuestionnaire, 'teen');\n    \n    expect(teenVariant.metadata.id).toBe('test-stress-adult-teen');\n    expect(teenVariant.metadata.title).toContain('ðŸ§‘');\n    expect(teenVariant.metadata.ageVariant).toBe('teen');\n    expect(teenVariant.metadata.baseTemplateId).toBe('test-stress-adult');\n    expect(teenVariant.metadata.tags).toContain('age-teen');\n    expect(teenVariant.metadata.tags).toContain('auto-generated');\n  });\n  \n  test('gÃ©nÃ¨re une variante kid correcte', () => {\n    const kidVariant = generateAgeVariant(mockAdultQuestionnaire, 'kid');\n    \n    expect(kidVariant.metadata.id).toBe('test-stress-adult-kid');\n    expect(kidVariant.metadata.title).toContain('ðŸ§’');\n    expect(kidVariant.metadata.ageVariant).toBe('kid');\n    expect(kidVariant.metadata.baseTemplateId).toBe('test-stress-adult');\n  });\n  \n  test('adapte les questions pour teen', () => {\n    const teenVariant = generateAgeVariant(mockAdultQuestionnaire, 'teen');\n    const firstQuestion = teenVariant.questions![0];\n    \n    // VÃ©rification du tutoiement\n    expect(firstQuestion.label).toContain('tu');\n    expect(firstQuestion.label).not.toContain('vous');\n    \n    // VÃ©rification du texte d'aide\n    expect(firstQuestion.helpText).toContain('ðŸ’¡');\n    expect(firstQuestion.helpText).toContain('pas de bonne ou mauvaise rÃ©ponse');\n  });\n  \n  test('adapte les questions pour kid', () => {\n    const kidVariant = generateAgeVariant(mockAdultQuestionnaire, 'kid');\n    const firstQuestion = kidVariant.questions![0];\n    \n    // Simplification du langage\n    expect(firstQuestion.label).toContain('tu');\n    expect(firstQuestion.label).toContain('sens'); // \"ressentez\" â†’ \"sens\"\n    \n    // Aide parentale\n    expect(firstQuestion.helpText).toContain('ðŸŒŸ');\n    expect(firstQuestion.helpText).toContain('parents');\n    \n    // Ã‰tiquettes d'Ã©chelle avec emojis\n    expect(firstQuestion.minLabel).toContain('ðŸ˜Š');\n    expect(firstQuestion.maxLabel).toContain('ðŸ˜°');\n  });\n  \n  test('adapte les options de rÃ©ponse', () => {\n    const kidVariant = generateAgeVariant(mockAdultQuestionnaire, 'kid');\n    const multipleChoiceQ = kidVariant.questions![1];\n    \n    const options = multipleChoiceQ.options as string[];\n    expect(options).toContain('Des fois'); // \"Parfois\" â†’ \"Des fois\"\n    expect(options).toContain('Beaucoup'); // \"Souvent\" â†’ \"Beaucoup\"\n  });\n});\n\ndescribe('ðŸ“š generateAllAgeVariants', () => {\n  test('gÃ©nÃ¨re toutes les variantes pour plusieurs questionnaires', () => {\n    const secondQuestionnaire: Questionnaire = {\n      metadata: {\n        id: 'test-sommeil',\n        title: 'Questionnaire sommeil',\n        category: 'sommeil'\n      },\n      questions: []\n    };\n    \n    const result = generateAllAgeVariants([mockAdultQuestionnaire, secondQuestionnaire]);\n    \n    expect(result.teen).toHaveLength(2);\n    expect(result.kid).toHaveLength(2);\n    \n    expect(result.teen[0].metadata.id).toBe('test-stress-adult-teen');\n    expect(result.teen[1].metadata.id).toBe('test-sommeil-teen');\n    expect(result.kid[0].metadata.id).toBe('test-stress-adult-kid');\n    expect(result.kid[1].metadata.id).toBe('test-sommeil-kid');\n  });\n});\n\ndescribe('ðŸ” getQuestionnaireVariant', () => {\n  test('retourne le questionnaire adult pour variant adult', () => {\n    const result = getQuestionnaireVariant(\n      mockAdultQuestionnaire,\n      'adult',\n      []\n    );\n    \n    expect(result).toBe(mockAdultQuestionnaire);\n  });\n  \n  test('trouve une variante existante', () => {\n    const teenVariant = generateAgeVariant(mockAdultQuestionnaire, 'teen');\n    const availableVariants = [teenVariant];\n    \n    const result = getQuestionnaireVariant(\n      mockAdultQuestionnaire,\n      'teen',\n      availableVariants\n    );\n    \n    expect(result).toBe(teenVariant);\n  });\n  \n  test('gÃ©nÃ¨re une variante Ã  la volÃ©e si non trouvÃ©e', () => {\n    const result = getQuestionnaireVariant(\n      mockAdultQuestionnaire,\n      'kid',\n      [] // Aucune variante disponible\n    );\n    \n    expect(result.metadata.ageVariant).toBe('kid');\n    expect(result.metadata.baseTemplateId).toBe('test-stress-adult');\n  });\n});\n\ndescribe('ðŸ“– Simplification du vocabulaire', () => {\n  test('applique les remplacements de vocabulaire', () => {\n    const texteComplexe = \"Vous ressentez parfois de l'anxiÃ©tÃ© et souvent de la fatigue\";\n    \n    let texteSimple = texteComplexe;\n    Object.entries(VOCABULARY_SIMPLIFICATION).forEach(([complex, simple]) => {\n      const regex = new RegExp(`\\\\b${complex}\\\\b`, 'gi');\n      texteSimple = texteSimple.replace(regex, simple);\n    });\n    \n    expect(texteSimple).toContain('sens'); // \"ressentez\" â†’ \"sens\"\n    expect(texteSimple).toContain('des fois'); // \"parfois\" â†’ \"des fois\"\n    expect(texteSimple).toContain('beaucoup'); // \"souvent\" â†’ \"beaucoup\"\n  });\n});\n\ndescribe('ðŸŽ¯ Configuration des adaptations', () => {\n  test('vÃ©rifie la configuration teen', () => {\n    const teenConfig = AGE_ADAPTATIONS.teen;\n    \n    expect(teenConfig.titlePrefix).toBe('ðŸ§‘ ');\n    expect(teenConfig.languageStyle).toBe('informal');\n    expect(teenConfig.simplification).toBe('moderate');\n    expect(teenConfig.examples).toBe(true);\n    expect(teenConfig.encouragement).toBe(true);\n  });\n  \n  test('vÃ©rifie la configuration kid', () => {\n    const kidConfig = AGE_ADAPTATIONS.kid;\n    \n    expect(kidConfig.titlePrefix).toBe('ðŸ§’ ');\n    expect(kidConfig.languageStyle).toBe('simple');\n    expect(kidConfig.simplification).toBe('high');\n    expect(kidConfig.parentHelp).toBe(true);\n    expect(kidConfig.visualAids).toBe(true);\n  });\n});\n\ndescribe('ðŸ”„ IntÃ©gration avec le systÃ¨me d\\'Ã¢ge', () => {\n  test('simule le workflow complet de sÃ©lection de variante', () => {\n    // Simule detectPatientAge rÃ©sultat\n    const mockAgeResults = [\n      { ageInYears: 25, variant: 'adult' as const },\n      { ageInYears: 15, variant: 'teen' as const },\n      { ageInYears: 8, variant: 'kid' as const }\n    ];\n    \n    mockAgeResults.forEach(({ ageInYears, variant }) => {\n      const questionnaire = getQuestionnaireVariant(\n        mockAdultQuestionnaire,\n        variant,\n        [] // GÃ©nÃ©ration Ã  la volÃ©e\n      );\n      \n      if (variant === 'adult') {\n        expect(questionnaire.metadata.ageVariant).toBeUndefined();\n      } else {\n        expect(questionnaire.metadata.ageVariant).toBe(variant);\n        expect(questionnaire.metadata.title).toContain(\n          variant === 'teen' ? 'ðŸ§‘' : 'ðŸ§’'\n        );\n      }\n      \n      // VÃ©rification des questions adaptÃ©es\n      if (variant !== 'adult') {\n        const firstQuestion = questionnaire.questions![0];\n        expect(firstQuestion.label).toContain('tu'); // Tutoiement\n        expect(firstQuestion.helpText).toBeTruthy(); // Aide ajoutÃ©e\n      }\n    });\n  });\n});\n\ndescribe('ðŸŽ¨ Cas d\\'usage spÃ©cifiques', () => {\n  test('Question d\\'Ã©chelle pour enfant avec emojis', () => {\n    const scaleQuestion: Question = {\n      id: 'scale-test',\n      label: 'ÃŠtes-vous fatiguÃ© ?',\n      type: 'scale',\n      scale: true,\n      scaleType: '0-4',\n      minLabel: 'Pas du tout',\n      maxLabel: 'Ã‰normÃ©ment'\n    };\n    \n    const mockQ: Questionnaire = {\n      metadata: {\n        id: 'scale-test-q',\n        title: 'Test Ã©chelle',\n        category: 'test'\n      },\n      questions: [scaleQuestion]\n    };\n    \n    const kidVariant = generateAgeVariant(mockQ, 'kid');\n    const adaptedQuestion = kidVariant.questions![0];\n    \n    expect(adaptedQuestion.minLabel).toBe('ðŸ˜Š Non, jamais');\n    expect(adaptedQuestion.maxLabel).toBe('ðŸ˜° Oui, beaucoup');\n  });\n  \n  test('Question textarea avec aide parentale', () => {\n    const textQuestion: Question = {\n      id: 'text-test',\n      label: 'DÃ©crivez vos symptÃ´mes',\n      type: 'textarea'\n    };\n    \n    const mockQ: Questionnaire = {\n      metadata: {\n        id: 'text-test-q',\n        title: 'Test texte',\n        category: 'test'\n      },\n      questions: [textQuestion]\n    };\n    \n    const kidVariant = generateAgeVariant(mockQ, 'kid');\n    const adaptedQuestion = kidVariant.questions![0];\n    \n    expect(adaptedQuestion.helpText).toContain('ðŸŒŸ');\n    expect(adaptedQuestion.helpText).toContain('parents');\n    expect(adaptedQuestion.label).toContain('tu'); // Tutoiement\n  });\n});
/**\n * ğŸ§’ NeuroNutrition - Mode Parent/Enfant pour Questionnaires Kids\n * \n * Interface spÃ©cialisÃ©e pour accompagner les enfants dans le remplissage\n * avec aide des parents (conformÃ©ment aux spÃ©cifications)\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { Card, CardHeader, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Heart, HelpCircle, MessageCircle, Star } from 'lucide-react';\nimport type { Question, QuestionResponse, AgeVariant } from '@neuronutrition/shared-questionnaires';\n\ninterface ParentChildQuestionnaireProps {\n  questions: Question[];\n  responses: Record<string, string | number>;\n  onResponseChange: (questionId: string, value: string | number) => void;\n  onSubmit: () => void;\n  ageVariant: AgeVariant;\n  patientAge: number;\n  isSubmitting?: boolean;\n}\n\ninterface ParentAssistanceMode {\n  isActive: boolean;\n  parentHelping: boolean;\n  childUnderstands: boolean;\n}\n\nexport function ParentChildQuestionnaire({\n  questions,\n  responses,\n  onResponseChange,\n  onSubmit,\n  ageVariant,\n  patientAge,\n  isSubmitting = false\n}: ParentChildQuestionnaireProps) {\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [parentMode, setParentMode] = useState<ParentAssistanceMode>({\n    isActive: ageVariant === 'kid',\n    parentHelping: false,\n    childUnderstands: true\n  });\n  const [encouragementShown, setEncouragementShown] = useState(false);\n\n  const currentQuestion = questions[currentQuestionIndex];\n  const progress = ((currentQuestionIndex + 1) / questions.length) * 100;\n  const isLastQuestion = currentQuestionIndex === questions.length - 1;\n\n  // ğŸŒŸ Messages d'encouragement adaptÃ©s Ã  l'Ã¢ge\n  const getEncouragementMessage = () => {\n    const messages = {\n      kid: [\n        \"ğŸŒŸ Super ! Tu rÃ©ponds trÃ¨s bien !\",\n        \"ğŸˆ Bravo ! Continue comme Ã§a !\",\n        \"ğŸ¦‹ Tu es formidable !\",\n        \"ğŸŒˆ Excellent travail !\",\n        \"â­ Tu y arrives trÃ¨s bien !\"\n      ],\n      teen: [\n        \"ğŸ’ª TrÃ¨s bien ! Continue !\",\n        \"ğŸŒŸ Tu gÃ¨res parfaitement !\",\n        \"âš¡ Super boulot !\",\n        \"ğŸ¯ Parfait ! Plus qu'un peu !\"\n      ],\n      adult: [\"TrÃ¨s bien, continuez !\"]\n    };\n    \n    const ageMessages = messages[ageVariant] || messages.adult;\n    return ageMessages[Math.floor(Math.random() * ageMessages.length)];\n  };\n\n  // ğŸ¯ Gestion des rÃ©ponses avec encouragement\n  const handleResponseChange = (value: string | number) => {\n    onResponseChange(currentQuestion.id, value);\n    \n    // Encouragement alÃ©atoire pour les enfants\n    if (ageVariant === 'kid' && Math.random() < 0.3) {\n      setEncouragementShown(true);\n      setTimeout(() => setEncouragementShown(false), 2000);\n    }\n  };\n\n  // â–¶ï¸ Navigation entre questions\n  const handleNext = () => {\n    if (isLastQuestion) {\n      onSubmit();\n    } else {\n      setCurrentQuestionIndex(prev => prev + 1);\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentQuestionIndex > 0) {\n      setCurrentQuestionIndex(prev => prev - 1);\n    }\n  };\n\n  // ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Basculer mode assistance parent\n  const toggleParentAssistance = () => {\n    setParentMode(prev => ({\n      ...prev,\n      parentHelping: !prev.parentHelping\n    }));\n  };\n\n  // ğŸ¨ Rendu de la question selon l'Ã¢ge et le type\n  const renderQuestion = () => {\n    if (!currentQuestion) return null;\n\n    const isKid = ageVariant === 'kid';\n    const currentValue = responses[currentQuestion.id] || '';\n\n    return (\n      <Card className={`transition-all duration-300 ${\n        isKid ? 'border-2 border-yellow-300 bg-gradient-to-br from-yellow-50 to-orange-50' :\n        ageVariant === 'teen' ? 'border-2 border-blue-300 bg-gradient-to-br from-blue-50 to-purple-50' :\n        'border-gray-200'\n      }`}>\n        <CardHeader>\n          <div className=\"flex justify-between items-start\">\n            <div className=\"flex-1\">\n              {/* ğŸ¯ Titre adaptÃ© Ã  l'Ã¢ge */}\n              <h3 className={`font-medium ${\n                isKid ? 'text-xl text-orange-800' :\n                ageVariant === 'teen' ? 'text-lg text-blue-800' :\n                'text-lg text-gray-800'\n              }`}>\n                {isKid ? 'ğŸŒŸ ' : ageVariant === 'teen' ? 'ğŸ’« ' : ''}\n                Question {currentQuestionIndex + 1}\n              </h3>\n              \n              {/* ğŸ“ Texte de la question */}\n              <p className={`mt-2 ${\n                isKid ? 'text-lg leading-relaxed text-gray-800' :\n                ageVariant === 'teen' ? 'text-base text-gray-700' :\n                'text-base text-gray-600'\n              }`}>\n                {currentQuestion.label}\n              </p>\n              \n              {/* ğŸ’¡ Aide spÃ©cifique */}\n              {currentQuestion.helpText && (\n                <div className={`mt-3 p-3 rounded-lg ${\n                  isKid ? 'bg-yellow-100 border-l-4 border-yellow-400' :\n                  ageVariant === 'teen' ? 'bg-blue-100 border-l-4 border-blue-400' :\n                  'bg-gray-100 border-l-4 border-gray-400'\n                }`}>\n                  <div className=\"flex items-start gap-2\">\n                    <HelpCircle size={16} className={isKid ? 'text-yellow-600 mt-0.5' : 'text-blue-600 mt-0.5'} />\n                    <p className=\"text-sm\">{currentQuestion.helpText}</p>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* ğŸ·ï¸ Indicateurs */}\n            <div className=\"flex flex-col gap-2\">\n              <Badge variant={isKid ? 'default' : 'secondary'}>\n                {currentQuestionIndex + 1} / {questions.length}\n              </Badge>\n              {isKid && parentMode.parentHelping && (\n                <Badge variant=\"outline\" className=\"text-purple-600\">\n                  ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Avec papa/maman\n                </Badge>\n              )}\n            </div>\n          </div>\n\n          {/* ğŸ“Š Barre de progression */}\n          <div className=\"mt-4\">\n            <Progress value={progress} className=\"h-2\" />\n            <p className=\"text-sm text-gray-500 mt-1\">\n              {isKid ? `ğŸˆ Tu as rÃ©pondu Ã  ${currentQuestionIndex + 1} questions sur ${questions.length} !` :\n               ageVariant === 'teen' ? `${Math.round(progress)}% terminÃ©` :\n               `${currentQuestionIndex + 1} sur ${questions.length} questions`}\n            </p>\n          </div>\n        </CardHeader>\n\n        <CardContent>\n          {/* ğŸ¯ Interface de rÃ©ponse */}\n          {renderQuestionInput(currentQuestion, currentValue, handleResponseChange)}\n\n          {/* ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ContrÃ´les mode parent (kids uniquement) */}\n          {isKid && (\n            <div className=\"mt-6 p-4 bg-purple-50 rounded-lg border border-purple-200\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <MessageCircle size={20} className=\"text-purple-600\" />\n                  <div>\n                    <h4 className=\"font-medium text-purple-800\">Aide des parents</h4>\n                    <p className=\"text-sm text-purple-600\">\n                      {parentMode.parentHelping ? \n                        'Papa ou maman m\\'aide Ã  rÃ©pondre' :\n                        'Je rÃ©ponds tout seul(e)'\n                      }\n                    </p>\n                  </div>\n                </div>\n                <Button\n                  variant={parentMode.parentHelping ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={toggleParentAssistance}\n                >\n                  {parentMode.parentHelping ? 'âœ… Avec aide' : 'ğŸ‘‹ Demander de l\\'aide'}\n                </Button>\n              </div>\n            </div>\n          )}\n\n          {/* â­ Message d'encouragement */}\n          {encouragementShown && (\n            <div className=\"mt-4 p-3 bg-green-100 border border-green-300 rounded-lg text-center animate-bounce\">\n              <p className=\"text-green-800 font-medium\">{getEncouragementMessage()}</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    );\n  };\n\n  // ğŸ›ï¸ Rendu des contrÃ´les de rÃ©ponse selon le type\n  const renderQuestionInput = (\n    question: Question,\n    value: string | number,\n    onChange: (value: string | number) => void\n  ) => {\n    const isKid = ageVariant === 'kid';\n    \n    // ğŸ“Š Questions Ã  Ã©chelle\n    if (question.scale && question.scaleType) {\n      const maxValue = question.scaleType === '0-4' ? 4 : question.scaleType === '0-10' ? 10 : 5;\n      \n      return (\n        <div className=\"space-y-4\">\n          {isKid && (\n            <p className=\"text-center text-lg font-medium text-gray-700\">\n              {question.minLabel || 'Pas du tout'} â† â†’ {question.maxLabel || 'Beaucoup'}\n            </p>\n          )}\n          \n          <div className=\"grid grid-cols-5 gap-2\">\n            {Array.from({ length: maxValue + 1 }, (_, i) => (\n              <Button\n                key={i}\n                variant={value === i ? 'default' : 'outline'}\n                size={isKid ? 'lg' : 'default'}\n                onClick={() => onChange(i)}\n                className={`${isKid ? 'text-lg h-12' : ''} relative`}\n              >\n                {isKid && i === 0 && 'ğŸ˜Š'}\n                {isKid && i === maxValue && 'ğŸ˜°'}\n                {i}\n              </Button>\n            ))}\n          </div>\n          \n          {isKid && (\n            <div className=\"flex justify-between text-sm text-gray-500\">\n              <span>{question.minLabel || 'ğŸ˜Š Non, jamais'}</span>\n              <span>{question.maxLabel || 'ğŸ˜° Oui, beaucoup'}</span>\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    // ğŸ“ Questions texte libre\n    if (question.type === 'textarea') {\n      return (\n        <textarea\n          value={value as string}\n          onChange={(e) => onChange(e.target.value)}\n          placeholder={isKid ? 'Ã‰cris ici avec papa ou maman...' : 'Votre rÃ©ponse...'}\n          rows={isKid ? 4 : 6}\n          className={`w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 ${\n            isKid ? 'text-lg' : 'text-base'\n          }`}\n        />\n      );\n    }\n\n    // ğŸ”¢ Questions numÃ©riques\n    if (question.type === 'number') {\n      return (\n        <input\n          type=\"number\"\n          value={value as number}\n          onChange={(e) => onChange(Number(e.target.value))}\n          className={`w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 ${\n            isKid ? 'text-lg text-center' : 'text-base'\n          }`}\n          placeholder={isKid ? 'Ã‰cris un chiffre' : 'Entrez un nombre'}\n        />\n      );\n    }\n\n    // âœ… Questions Ã  choix multiple\n    if (question.options) {\n      return (\n        <div className=\"space-y-2\">\n          {question.options.map((option, index) => {\n            const optionValue = typeof option === 'string' ? option : option.value;\n            const optionLabel = typeof option === 'string' ? option : option.label;\n            \n            return (\n              <Button\n                key={index}\n                variant={value === optionValue ? 'default' : 'outline'}\n                size={isKid ? 'lg' : 'default'}\n                onClick={() => onChange(optionValue)}\n                className={`w-full justify-start ${\n                  isKid ? 'text-lg h-14 text-left' : 'h-12'\n                }`}\n              >\n                {value === optionValue && (\n                  <Star size={isKid ? 20 : 16} className=\"mr-2 text-yellow-400 fill-current\" />\n                )}\n                {optionLabel}\n              </Button>\n            );\n          })}\n        </div>\n      );\n    }\n\n    return null;\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto space-y-6\">\n      {/* ğŸ¯ En-tÃªte adaptÃ© Ã  l'Ã¢ge */}\n      <div className={`text-center p-6 rounded-lg ${\n        ageVariant === 'kid' ? 'bg-gradient-to-r from-yellow-400 to-orange-400 text-white' :\n        ageVariant === 'teen' ? 'bg-gradient-to-r from-blue-400 to-purple-400 text-white' :\n        'bg-gradient-to-r from-gray-400 to-gray-600 text-white'\n      }`}>\n        <h1 className=\"text-2xl font-bold\">\n          {ageVariant === 'kid' ? 'ğŸŒŸ Questionnaire pour toi !' :\n           ageVariant === 'teen' ? 'ğŸ’« Ton questionnaire' :\n           'Questionnaire'}\n        </h1>\n        {ageVariant === 'kid' && (\n          <p className=\"mt-2 text-lg opacity-90\">\n            ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Papa ou maman peuvent t'aider Ã  rÃ©pondre !\n          </p>\n        )}\n      </div>\n\n      {/* ğŸ“‹ Question actuelle */}\n      {renderQuestion()}\n\n      {/* ğŸ›ï¸ Navigation */}\n      <div className=\"flex justify-between items-center\">\n        <Button\n          variant=\"outline\"\n          onClick={handlePrevious}\n          disabled={currentQuestionIndex === 0}\n          size={ageVariant === 'kid' ? 'lg' : 'default'}\n        >\n          â† {ageVariant === 'kid' ? 'Question d\\'avant' : 'PrÃ©cÃ©dent'}\n        </Button>\n\n        <div className=\"flex items-center gap-2\">\n          {ageVariant === 'kid' && (\n            <Heart size={20} className=\"text-red-400 animate-pulse\" />\n          )}\n          <span className=\"text-sm text-gray-600\">\n            {ageVariant === 'kid' ? 'ğŸŒˆ Tu y arrives super bien !' :\n             ageVariant === 'teen' ? 'ğŸ’ª Continue comme Ã§a !' :\n             'Continuez'}\n          </span>\n        </div>\n\n        <Button\n          onClick={handleNext}\n          disabled={!responses[currentQuestion?.id] || isSubmitting}\n          size={ageVariant === 'kid' ? 'lg' : 'default'}\n          className={ageVariant === 'kid' ? 'text-lg px-8' : ''}\n        >\n          {isSubmitting && (\n            <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n          )}\n          {isLastQuestion ? \n            (ageVariant === 'kid' ? 'ğŸ‰ Terminer !' : 'Terminer') :\n            (ageVariant === 'kid' ? 'Question suivante â†’' : 'Suivant â†’')\n          }\n        </Button>\n      </div>\n    </div>\n  );\n}